var __extends=this&&this.__extends||function(){var r=function(e,t){r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s))e[s]=t[s]};return r(e,t)};return function(e,t){r(e,t);function s(){this.constructor=e}e.prototype=t===null?Object.create(t):(s.prototype=t.prototype,new s)}}();var suncore;(function(e){var g;(function(e){e[e["PRIORITY_0"]=0]="PRIORITY_0";e[e["PRIORITY_HIGH"]=1]="PRIORITY_HIGH";e[e["PRIORITY_NOR"]=2]="PRIORITY_NOR";e[e["PRIORITY_LOW"]=3]="PRIORITY_LOW";e[e["PRIORITY_LAZY"]=4]="PRIORITY_LAZY";e[e["PRIORITY_TRIGGER"]=5]="PRIORITY_TRIGGER";e[e["PRIORITY_TASK"]=6]="PRIORITY_TASK";e[e["PRIORITY_PROMISE"]=7]="PRIORITY_PROMISE";e[e["E_MAX"]=8]="E_MAX"})(g=e.MessagePriorityEnum||(e.MessagePriorityEnum={}));var d;(function(e){e[e["SYSTEM"]=0]="SYSTEM";e[e["CUSTOM"]=1]="CUSTOM";e[e["TIMELINE"]=2]="TIMELINE";e[e["MAX"]=3]="MAX"})(d=e.ModuleEnum||(e.ModuleEnum={}));var t=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_done=false;e.$var_running=false;return e}e.prototype.cancel=function(){};Object.defineProperty(e.prototype,"done",{get:function(){return this.$var_done},set:function(e){if(this.$var_done!==e){this.$var_done=e;if(e===true){this.cancel()}}},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"running",{get:function(){return this.$var_running},set:function(e){this.$var_running=e},enumerable:false,configurable:true});return e}(puremvc.Notifier);e.AbstractTask=t;var s=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_running=false;return e}e.prototype.run=function(){if(this.$var_running===true){suncom.Logger.warn("服务["+suncom.Common.getQualifiedClassName(this)+"]己运行");return}this.$var_running=true;this.$onRun()};e.prototype.stop=function(){if(this.$var_running===false){suncom.Logger.warn("服务["+suncom.Common.getQualifiedClassName(this)+"]未运行");return}this.$var_running=false;this.$onStop()};Object.defineProperty(e.prototype,"running",{get:function(){return this.$var_running},enumerable:false,configurable:true});return e}(puremvc.Notifier);e.BaseService=s;var r=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$delta=0;e.$runTime=0;e.$localTime=Date.now();Laya.timer.frameLoop(1,e,e.$onFrameLoop);_(m.NAME,new m);return e}e.prototype.destroy=function(){if(this.$destroyed===false){Laya.timer.clear(this,this.$onFrameLoop);E(m.NAME);t.prototype.destroy.call(this)}};e.prototype.$onFrameLoop=function(){if(this.$destroyed===false){var e=this.$localTime;this.$localTime=Date.now();this.$delta=this.$localTime-e;if(this.$delta>0){this.$runTime+=this.$delta;this.$tick(this.$delta)}}};e.prototype.$tick=function(e){if(y.isModulePaused(d.CUSTOM)===false){T.timeStamp.tick(e)}if(y.isModulePaused(d.TIMELINE)===false){T.timeline.tick(e)}this.facade.sendNotification(M.PHYSICS_PREPARE);this.facade.sendNotification(M.PHYSICS_FRAME);T.timerManager.executeTimer();this.facade.sendNotification(M.DRIVE_TWEEN_TICK);this.facade.sendNotification(M.ENTER_FRAME);T.messageManager!==null&&T.messageManager.dealMessage();T.messageManager!==null&&T.messageManager.classifyMessages0();this.facade.sendNotification(M.LATER_FRAME)};e.prototype.getTime=function(){return this.$runTime};e.prototype.getDelta=function(){return this.$delta};return e}(puremvc.Notifier);e.Engine=r;var v=function(){function e(){this.mod=d.SYSTEM;this.priority=g.PRIORITY_0;this.weights=0;this.task=null;this.groupId=0;this.args=null;this.method=null;this.caller=null;this.timeout=0}e.prototype.recover=function(){this.task=null;this.args=null;this.method=null;this.caller=null;suncom.Pool.recover("suncore.Message",this)};return e}();e.Message=v;var i=function(){function e(){this.$queues=[];for(var e=0;e<d.MAX;e++){this.$queues[e]=new o(e)}}e.prototype.putMessage=function(e){this.$queues[e.mod].putMessage(e)};e.prototype.dealMessage=function(){for(var e=0;e<d.MAX;e++){if(y.isModulePaused(e)===false){this.$queues[e].dealMessage()}}};e.prototype.classifyMessages0=function(){for(var e=0;e<d.MAX;e++){if(y.isModuleStopped(e)===false){this.$queues[e].classifyMessages0()}}};e.prototype.clearMessages=function(e){this.$queues[e].clearMessages()};e.prototype.cancelTaskByGroupId=function(e,t){this.$queues[e].cancelTaskByGroupId(t)};e.prototype.addCustomMessageId=function(e,t,s){if(s===void 0){s=null}this.$queues[e].addCustomMessageId(t,s)};e.prototype.removeCustomMessageId=function(e,t){this.$queues[e].removeCustomMessageId(t)};e.prototype.removeAllCustomMessageId=function(e){this.$queues[e].removeAllCustomMessageId()};return e}();e.MessageManager=i;var o=function(){function e(e){this.$tasks=[];this.$queues=[];this.$messages0=[];this.$canceled=false;this.$weights=0;this.$customMessageMap={};this.$customMessageCount=0;this.$customMessageRemovedThisFrameCount=0;this.$mod=e;for(var t=0;t<g.E_MAX;t++){this.$queues[t]=[]}}e.prototype.putMessage=function(e){this.$messages0.push(e);if(e.priority===g.PRIORITY_PROMISE){this.$initPromiseWeights(e)}};e.prototype.$initPromiseWeights=function(e){var t=this.$queues[g.PRIORITY_PROMISE];if(t.length===0){e.weights=this.$weights}else{var s=t[0];if(s.task.running===false){e.weights=this.$weights}else{e.weights=this.$weights=t[0].weights+1}}};e.prototype.dealMessage=function(){var e=0;var t=0;for(var s=0;s<g.E_MAX;s++){var r=void 0;if(s===g.PRIORITY_TASK){r=this.$tasks}else{r=this.$queues[s]}if(r.length===0||s===g.PRIORITY_LAZY){continue}if(s===g.PRIORITY_TASK){for(var i=this.$tasks.length-1;i>-1;i--){var o=this.$tasks[i];if(o.length>0&&this.$dealTaskMessage(o[0])===true){o.shift().recover();e++}if(o.length>1){t+=o.length-1}else if(o.length===0){this.$tasks.splice(i,1)}}}else if(s===g.PRIORITY_PROMISE){while(r.length>0){e++;var n=r[0];if(this.$dealTaskMessage(n)===false){break}r.shift().recover();if(this.$weights>n.weights){break}}}else if(s===g.PRIORITY_TRIGGER){while(r.length>0&&this.$dealTriggerMessage(r[0])===true){r.shift().recover();if(this.$canceled===false){e++}}}else{var a=0;var u=this.$getDealCountByPriority(s);for(;r.length>0&&(u===0||a<u);a++){var l=r.shift();if(this.$dealCustomMessage(l)===false){a--}l.recover()}e+=a}t+=r.length}if(this.$customMessageCount===0&&this.$customMessageRemovedThisFrameCount===0){if(t===0&&e===0&&this.$messages0.length===0){var r=this.$queues[g.PRIORITY_LAZY];if(r.length>0){var l=r.shift();this.$dealCustomMessage(l);e++;l.recover()}}}this.$customMessageRemovedThisFrameCount=0};e.prototype.$dealTaskMessage=function(e){var t=e.task;if(t.running===false){t.running=true;if(t.run()===true){t.done=true}}return t.done===true};e.prototype.$dealTriggerMessage=function(e){if(e.timeout>y.getModuleTimestamp(this.$mod)){return false}this.$canceled=e.method.apply(e.caller,e.args)===false;return true};e.prototype.$dealCustomMessage=function(e){return e.method.apply(e.caller,e.args)!==false};e.prototype.$getDealCountByPriority=function(e){if(e===g.PRIORITY_0){return 0}if(e===g.PRIORITY_HIGH){return 10}if(e===g.PRIORITY_NOR){return 3}if(e===g.PRIORITY_LOW){return 1}throw Error("错误的消息优先级")};e.prototype.classifyMessages0=function(){while(this.$messages0.length>0){var e=this.$messages0.shift();if(e.priority===g.PRIORITY_TASK){this.$addTaskMessage(e)}else if(e.priority===g.PRIORITY_TRIGGER){this.$addTriggerMessage(e)}else if(e.priority===g.PRIORITY_PROMISE){this.$addPromiseMessage(e)}else{this.$queues[e.priority].push(e)}}this.$customMessageRemovedThisFrameCount=0};e.prototype.$addPromiseMessage=function(e){var t=this.$queues[g.PRIORITY_PROMISE];var s=-1;for(var r=0;r<t.length;r++){var i=t[r];if(i.task.running===true){continue}if(i.weights<e.weights){s=r;break}}if(s===-1){t.push(e)}else{t.splice(s,0,e)}};e.prototype.$addTriggerMessage=function(e){var t=this.$queues[g.PRIORITY_TRIGGER];var s=0;var r=0;var i=t.length-1;while(i-s>1){r=Math.floor((s+i)*.5);if(t[r].timeout<=e.timeout){s=r}else if(t[r].timeout>e.timeout){i=r}else{break}}var o=-1;for(var n=s;n<=i;n++){if(t[n].timeout>e.timeout){o=n;break}}if(o<0){t.push(e)}else{t.splice(o,0,e)}};e.prototype.$addTaskMessage=function(e){var t=-1;for(var s=0;s<this.$tasks.length;s++){var r=this.$tasks[s];if(r.length>0&&r[0].groupId===e.groupId){t=s;break}}if(t===-1){this.$tasks.unshift([e])}else{this.$tasks[t].push(e)}};e.prototype.clearMessages=function(){while(this.$messages0.length>0){this.$cancelMessage(this.$messages0.shift())}for(var e=0;e<this.$tasks.length;e++){var t=this.$tasks[e];while(t.length>0){this.$cancelMessage(t.shift())}}for(var s=0;s<g.E_MAX;s++){var r=this.$queues[s];while(r.length>0){this.$cancelMessage(r.shift())}}};e.prototype.$cancelMessage=function(e){if(e.priority===g.PRIORITY_TASK){e.task.done=true}e.recover()};e.prototype.cancelTaskByGroupId=function(e){for(var t=0;t<this.$tasks.length;t++){var s=this.$tasks[t];if(s.length>0&&s[0].groupId===e){while(s.length>0){var r=s.shift();r.task.done=true;r.recover()}break}}};e.prototype.addCustomMessageId=function(e,t){if(this.$customMessageMap[e]===void 0){this.$customMessageMap[e]=t;this.$customMessageCount++;if(t!==null){suncom.Logger.info("suncore::addCustomMessageId=> messageId:"+e+", messageCount:"+this.$customMessageCount+", message: 开始 "+t)}}else{suncom.Test.notExpected()}};e.prototype.removeCustomMessageId=function(e){var t=this.$customMessageMap[e];if(t!==void 0){delete this.$customMessageMap[e];this.$customMessageCount--;this.$customMessageRemovedThisFrameCount++;if(t!==null){suncom.Logger.info("suncore::removeCustomMessageId=> messageId:"+e+", messageCount:"+this.$customMessageCount+", message: 结束 "+t)}}else{suncom.Test.notExpected()}};e.prototype.removeAllCustomMessageId=function(){this.$customMessageMap={};this.$customMessageCount=0;this.$customMessageRemovedThisFrameCount=0};return e}();e.MessageQueue=o;var n=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t){if(t!==true&&t!==false){throw Error("参数stop应当为布尔值")}if(t===true){if(y.isModuleStopped(e)===true){suncom.Logger.error("模块 "+d[e]+" 己经停止！！！");return}}else if(y.isModulePaused(e)===true){suncom.Logger.error("模块 "+d[e]+" 己经暂停！！！");return}else if(e===d.SYSTEM){suncom.Logger.error("无法暂停 "+d[e]+" 模块！！！");return}if(e===d.TIMELINE){T.timeline.pause(t)}else if(e===d.CUSTOM){T.timeStamp.pause(t)}if(t===false){return}if(e===d.SYSTEM){if(y.isModuleStopped(d.TIMELINE)===false||y.isModuleStopped(d.CUSTOM)===false){suncom.Logger.error("SYSTEM 不能停止因为 CUSTOM 或 TIMELINE 依然在运行")}}T.timerManager.clearTimer(e);T.messageManager.clearMessages(e);T.messageManager.removeAllCustomMessageId(e);if(e===d.TIMELINE){T.timeline=null}else if(e===d.CUSTOM){T.timeStamp=null}else{T.engine.destroy();T.engine=null}if(e===d.SYSTEM){T.timerManager=null;T.messageManager=null}};return t}(puremvc.SimpleCommand);e.PauseTimelineCommand=n;var a=function(i){__extends(e,i);function e(e,t,s){if(s===void 0){s=null}var r=i.call(this)||this;r.$var_args=null;r.$var_caller=null;r.$var_method=null;r.$var_args=s;r.$var_caller=e;r.$var_method=t;return r}e.prototype.run=function(){this.$var_method.apply(this.$var_caller,this.$var_args);return true};return e}(t);e.SimpleTask=a;var u=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t){if(t!==true&&t!==false){throw Error("参数pause应当为布尔值")}if(y.isModulePaused(e)===false){suncom.Logger.error("模块 "+d[e]+" 己经启动！！！");return}if(e===d.SYSTEM&&T.engine===null){T.timerManager=new c;T.messageManager=new i}if(e===d.TIMELINE){if(T.timeline===null){T.timeline=new l}T.timeline.resume(t)}else if(e===d.CUSTOM){if(T.timeStamp===null){T.timeStamp=new l}T.timeStamp.resume(t)}else if(e===d.SYSTEM){if(T.engine===null){T.engine=new r}}};return t}(puremvc.SimpleCommand);e.StartTimelineCommand=u;var l=function(){function e(){this.$runTime=0;this.$paused=true;this.$stopped=true}e.prototype.tick=function(e){this.$runTime+=e};e.prototype.pause=function(e){this.$paused=true;this.$stopped=e};e.prototype.resume=function(e){this.$paused=e;this.$stopped=false};e.prototype.getTime=function(){return this.$runTime};Object.defineProperty(e.prototype,"paused",{get:function(){return this.$paused},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"stopped",{get:function(){return this.$stopped},enumerable:false,configurable:true});return e}();e.Timeline=l;var I=function(){function e(){this.mod=d.SYSTEM;this.active=false;this.delay=0;this.method=null;this.caller=null;this.args=null;this.real=false;this.count=0;this.loops=1;this.timerId=0;this.timestamp=-1;this.timeout=0}e.prototype.recover=function(){this.method=null;this.caller=null;this.args=null;suncom.Pool.recover("suncore.Timer",this)};return e}();e.Timer=I;var c=function(){function e(){this.$timers=[];this.$timerMap={};for(var e=0;e<d.MAX;e++){this.$timers[e]=[]}}e.prototype.executeTimer=function(){for(var e=0;e<d.MAX;e++){if(y.isModulePaused(e)===false){var t=this.$timers[e];var s=y.getModuleTimestamp(e);while(t.length>0){var r=t[0];if(r.active===true){if(r.timeout>s){break}if(r.real===true){r.count++}else{r.count=Math.min(Math.floor((s-r.timestamp)/r.delay),r.loops)}}if(r.active===false||r.loops>0&&r.count>=r.loops){delete this.$timerMap[r.timerId]}else{this.addTimer(r.mod,r.delay,r.method,r.caller,r.args,r.loops,r.real,r.timerId,r.timestamp,r.timeout,r.count)}t.shift();if(r.active===true){if(r.args===null){r.method.call(r.caller,r.count,r.loops)}else{r.method.apply(r.caller,r.args.concat(r.count,r.loops))}}r.recover()}}}};e.prototype.addTimer=function(e,t,s,r,i,o,n,a,u,l,c){if(i===void 0){i=null}if(o===void 0){o=1}if(n===void 0){n=false}if(a===void 0){a=0}if(u===void 0){u=-1}if(l===void 0){l=-1}if(c===void 0){c=0}var f=y.getModuleTimestamp(e);if(a===0){a=suncom.Common.createHashId()}if(u===-1){u=f}if(l===-1){l=f}var h;if(typeof t==="number"){h=t}else{h=t[1]||0;t=t[0]}if(t<1){t=1}var p=0;if(n===true){p=(f-l)%t}else{p=(f-u)%t}l=f+t-p;if(h===0){if(i===null){s.call(r,0,o)}else{s.apply(r,i.concat(0,o))}}else if(h<t){var m=t-h;l=suncom.Mathf.clamp(l-m,f+1,l)}var g=suncom.Pool.getItemByClass("suncore.Timer",I);g.mod=e;g.active=true;g.delay=t;g.method=s;g.caller=r;g.args=i;g.real=n;g.count=c;g.loops=o;g.timerId=a;g.timestamp=u;g.timeout=l;var d=this.$timers[e];var v=0;var $=0;var T=d.length-1;while(T-v>1){$=Math.floor((v+T)*.5);if(d[$].timeout<=l){v=$}else if(d[$].timeout>l){T=$}else{break}}var M=-1;for(var _=v;_<=T;_++){if(d[_].timeout>l){M=_;break}}if(M<0){d.push(g)}else{d.splice(M,0,g)}this.$timerMap[a]=g;return a};e.prototype.removeTimer=function(e){if(e>0&&this.$timerMap[e]!==void 0){this.$timerMap[e].active=false}return 0};e.prototype.clearTimer=function(e){var t=this.$timers[e];while(t.length>0){var s=t.pop();delete this.$timerMap[s.timerId];s.recover()}};return e}();e.TimerManager=c;var f=function(t){__extends(i,t);function i(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_hashId=0;e.$var_mod=d.SYSTEM;e.$var_target=null;e.$var_props=null;e.$var_actions=[];e.$var_usePool=false;e.$var_recovered=false;e.$var_correctTimestamp=-1;return e}i.prototype.$func_setTo=function(e,t){if(this.$var_hashId===-1){throw Error("Tween己被回收！！！")}this.$var_mod=t;this.$var_target=e;this.$var_hashId=suncom.Common.createHashId();if(y.isModuleStopped(t)===false){this.facade.sendNotification(M.REGISTER_TWEEN_OBJECT,this)}else{suncom.Logger.error("尝试添加缓动，但时间轴己停止，mod:"+d[t])}return this};i.prototype.cancel=function(){this.$var_props=null;while(this.$var_actions.length>0){this.$var_actions.pop().recover()}return this};i.prototype.recover=function(){this.$var_recovered=true};i.prototype.func_recover=function(){if(this.$var_hashId>-1){this.$var_hashId=-1;this.$var_recovered=false;this.$removeFromTweens();suncom.Pool.recover("sunui.Tween",this.cancel())}};i.prototype.$removeFromTweens=function(){var e=T.tweens.get(this.$var_target);var t=e.indexOf(this);suncom.Test.expect(t).toBeGreaterOrEqualThan(0);e.splice(t,1);e.length===0&&T.tweens.remove(this.$var_target)};i.prototype.to=function(e,t,s,r){if(s===void 0){s=null}if(r===void 0){r=null}var i=Object.keys(e);var o=this.$var_props===null?this.$var_target:this.$var_props;this.$func_createTweenInfo(i,o,e,t,s,e.update||null,r);return this};i.prototype.from=function(e,t,s,r){if(s===void 0){s=null}if(r===void 0){r=null}var i=Object.keys(e);var o=this.$var_props===null?this.$var_target:this.$var_props;this.$func_createTweenInfo(i,e,o,t,s,e.update||null,r);return this};i.prototype.by=function(e,t,s,r){if(s===void 0){s=null}if(r===void 0){r=null}var i=Object.keys(e);var o=this.$var_props===null?this.$var_target:this.$var_props;for(var n=0;n<i.length;n++){var a=i[n];if(a==="update"){continue}if(this.$var_props===null||this.$var_props[a]===void 0){e[a]+=this.$var_target[a]}else{e[a]+=o[a]}}this.to(e,t,s,r);return this};i.prototype.$func_createTweenInfo=function(e,t,s,r,i,o,n){this.$var_props=this.$var_props||{};var a=h.create();a.ease=i;a.update=o;a.complete=n;if(this.$var_correctTimestamp>-1){a.time=this.$var_correctTimestamp;this.$var_correctTimestamp=-1}else{a.time=y.getModuleTimestamp(this.$var_mod)}a.duration=r;for(var u=0;u<e.length;u++){var l=e[u];if(l==="update"){continue}var c=p.create();c.to=s[l];c.from=t[l];c.prop=l;if(c.from===void 0){c.from=this.$var_target[l]}this.$var_props[l]=s[l];if(this.$var_actions.length===0){this.$var_target[c.prop]=c.from}a.clips.push(c)}if(a.update!==null){a.update.run()}this.$func_addAction(a)};i.prototype.$func_addAction=function(e){if(this.$var_hashId===-1){throw Error("Tween己被回收！！！")}if(this.$var_recovered===true){throw Error("Tween己被外部标记为回收！！！")}this.$var_actions.push(e)};i.prototype.wait=function(e,t){if(t===void 0){t=null}var s=h.create();s.complete=t;s.time=y.getModuleTimestamp(this.$var_mod);s.duration=e;this.$func_addAction(s);return this};i.prototype.func_doAction=function(){var e=y.getModuleTimestamp(this.$var_mod);var t=this.$var_actions[0];if(this.$var_target instanceof fairygui.GObject){if(this.$var_target.isDisposed===true){this.cancel();return 0}}else if(this.$var_target.destroyed===true){this.cancel();return 0}var s=false;var r=0;var i=e-t.time;if(i>t.duration){s=true;r=i-t.duration;i=t.duration}var o=t.ease||this.$func_easeNone;for(var n=0;n<t.clips.length;n++){var a=t.clips[n];if(s===true){this.$var_target[a.prop]=a.to}else{this.$var_target[a.prop]=o(i,a.from,a.to-a.from,t.duration)}}if(t.update!==null){t.update.run()}if(s===false){return 0}this.$var_actions.shift();if(this.$var_actions.length>0){this.$var_actions[0].time=y.getModuleTimestamp(this.$var_mod)}t.complete!==null&&t.complete.run();t.recover();return r};i.prototype.$func_easeNone=function(e,t,s,r){var i=e/r;if(i>1){i=1}return i*s+t};i.prototype.usePool=function(e){this.$var_usePool=e;return this};i.prototype.correctTimestamp=function(e){this.$var_correctTimestamp=e;return this};i.prototype.func_getUsePool=function(){return this.$var_usePool};Object.defineProperty(i.prototype,"var_mod",{get:function(){return this.$var_mod},enumerable:false,configurable:true});Object.defineProperty(i.prototype,"var_canceled",{get:function(){return this.$var_actions.length===0},enumerable:false,configurable:true});Object.defineProperty(i.prototype,"var_recovered",{get:function(){return this.$var_recovered},enumerable:false,configurable:true});i.get=function(e,t){if(t===void 0){t=d.CUSTOM}var s=suncom.Pool.getItemByClass("sunui.Tween",i);s.$var_hashId=0;s.$var_correctTimestamp=-1;var r=T.tweens.get(e)||null;if(r===null){r=[];T.tweens.set(e,r)}r.push(s);return s.usePool(true).$func_setTo(e,t)};i.clearAll=function(e){var t=T.tweens.get(e)||null;if(t===null){return e}for(var s=0;s<t.length;s++){t[s].cancel().recover()}return e};return i}(puremvc.Notifier);e.Tween=f;var h=function(){function e(){this.ease=null;this.clips=[];this.update=null;this.complete=null;this.time=0;this.duration=0}e.prototype.recover=function(){this.ease=null;while(this.clips.length>0){this.clips.pop().recover()}this.update=null;this.complete=null;this.time=0;this.duration=0;suncom.Pool.recover("sunui.TweenAction",this)};e.create=function(){return suncom.Pool.getItemByClass("sunui.TweenAction",e)};return e}();e.TweenAction=h;var p=function(){function e(){this.prop=null;this.from=0;this.to=0}e.prototype.recover=function(){this.prop=null;this.from=0;this.to=0;suncom.Pool.recover("sunui.TweenActionClip",this)};e.create=function(){return suncom.Pool.getItemByClass("sunui.TweenActionClip",e)};return e}();e.TweenActionClip=p;var m=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$tweens=[];e.$locker=false;return e}e.prototype.$onRun=function(){this.facade.registerObserver(M.PAUSE_TIMELINE,this.$onTimelinePause,this,false,suncom.EventPriorityEnum.EGL);this.facade.registerObserver(M.DRIVE_TWEEN_TICK,this.$onDriveTweenTick,this);this.facade.registerObserver(M.REGISTER_TWEEN_OBJECT,this.$onRegisterTweenObject,this)};e.prototype.$onStop=function(){this.facade.removeObserver(M.PAUSE_TIMELINE,this.$onTimelinePause,this);this.facade.removeObserver(M.DRIVE_TWEEN_TICK,this.$onDriveTweenTick,this);this.facade.removeObserver(M.REGISTER_TWEEN_OBJECT,this.$onRegisterTweenObject,this)};e.prototype.$onTimelinePause=function(e,t){if(t===true){for(var s=0;s<this.$tweens.length;s++){var r=this.$tweens[s];if(r.var_mod===e){r.cancel()}}}};e.prototype.$onDriveTweenTick=function(){this.$locker=true;var e=this.$tweens;for(var t=0;t<d.MAX;t++){if(y.isModulePaused(t)===false){for(var s=0;s<e.length;s++){var r=e[s];if(r.var_mod===t){var i=1;while(i>0&&r.var_canceled===false&&r.var_recovered===false){i=r.func_doAction()}}}}}for(var s=this.$tweens.length-1;s>-1;s--){var r=this.$tweens[s];if(r.func_getUsePool()===true){if(r.var_canceled===false){continue}}else if(r.var_recovered===false){continue}e.splice(s,1)[0].func_recover()}this.$locker=false};e.prototype.$onRegisterTweenObject=function(e){if(this.$locker===true){this.$tweens=this.$tweens.slice(0);this.$locker=false}this.$tweens.push(e)};e.NAME="suncore.TweenService";return e}(s);e.TweenService=m;var $=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(){var e=this.$resolve.bind(this);this.$var_method.apply(this.$var_caller,this.$var_args===null?[e]:[e].concat(this.$var_args));return this.done};t.prototype.$resolve=function(){this.done=true};return t}(a);e.PromiseTask=$;var T;(function(e){e.tweens=new suncom.HashMap;e.engine=null;e.timeline=null;e.timeStamp=null;e.timerManager=null;e.messageManager=null})(T=e.M||(e.M={}));var M;(function(e){e.STARTUP="suncore.NotifyKey.STARTUP";e.SHUTDOWN="suncore.NotifyKey.SHUTDOWN";e.START_TIMELINE="suncore.NotifyKey.START_TIMELINE";e.PAUSE_TIMELINE="suncore.NotifyKey.PAUSE_TIMELINE";e.PHYSICS_FRAME="suncore.NotifyKey.PHYSICS_FRAME";e.PHYSICS_PREPARE="suncore.NotifyKey.PHYSICS_PREPARE";e.ENTER_FRAME="suncore.NotifyKey.ENTER_FRAME";e.LATER_FRAME="suncore.NotifyKey.LATER_FRAME";e.REGISTER_TWEEN_OBJECT="suncore.NotifyKey.REGISTER_TWEEN_OBJECT";e.DRIVE_TWEEN_TICK="suncore.NotifyKey.DRIVE_TWEEN_TICK"})(M=e.NotifyKey||(e.NotifyKey={}));var y;(function(e){e.$taskGroupId=1e3;function t(){this.$taskGroupId++;return this.$taskGroupId}e.createTaskGroupId=t;function s(e){if(e===d.TIMELINE){if(T.timeline===null||T.timeline.stopped===true){return true}}else if(e===d.CUSTOM){if(T.timeStamp===null||T.timeStamp.stopped===true){return true}}else if(T.engine===null){return true}return false}e.isModuleStopped=s;function r(e){if(s(e)===true){return true}if(e===d.TIMELINE){return T.timeline.paused}else if(e===d.CUSTOM){return T.timeStamp.paused}return false}e.isModulePaused=r;function i(){if(s(d.SYSTEM)===false){return T.engine.getDelta()}else{suncom.Logger.error("尝试获取帧时间间隔，但系统模块己停止！！！")}}e.getDelta=i;function o(e){if(s(e)===false){if(e===d.TIMELINE){return T.timeline.getTime()}else if(e===d.CUSTOM){return T.timeStamp.getTime()}return T.engine.getTime()}else{suncom.Logger.error("尝试获取时间戳，但模块 "+d[e]+" 己停止！！！")}}e.getModuleTimestamp=o;function n(e,t,s){if(s===void 0){s=0}if(this.isModuleStopped(e)===false){if(s===-1){s=this.createTaskGroupId()}else if(s>1e3){throw Error("自定义的Task GroupId不允许超过1000")}var r=suncom.Pool.getItemByClass("suncore.Message",v);r.mod=e;r.task=t;r.groupId=s;r.priority=g.PRIORITY_TASK;T.messageManager.putMessage(r)}else{s=-1;suncom.Logger.error("尝试添加任务，但模块 "+d[e]+" 己停止！！！")}return s}e.addTask=n;function a(e,t){T.messageManager.cancelTaskByGroupId(e,t)}e.cancelTaskByGroupId=a;function u(e,t,s,r,i){if(i===void 0){i=null}if(this.isModuleStopped(e)===false){var o=suncom.Pool.getItemByClass("suncore.Message",v);o.mod=e;o.args=i;o.caller=s;o.method=r;o.timeout=this.getModuleTimestamp(e)+t;o.priority=g.PRIORITY_TRIGGER;T.messageManager.putMessage(o)}else{suncom.Logger.error("尝试添加触发器，但模块 "+d[e]+" 己停止！！！")}}e.addTrigger=u;function l(e,t,s,r){if(r===void 0){r=null}if(this.isModuleStopped(e)===false){var i=suncom.Pool.getItemByClass("suncore.Message",v);i.mod=e;i.task=new $(t,s,r);i.priority=g.PRIORITY_PROMISE;T.messageManager.putMessage(i)}else{suncom.Logger.error("尝试添加Promise消息，但模块 "+d[e]+" 己停止！！！")}}e.addPromise=l;function c(e,t,s,r,i){if(i===void 0){i=null}if(this.isModuleStopped(e)===false){var o=suncom.Pool.getItemByClass("suncore.Message",v);o.mod=e;o.args=i;o.caller=s;o.method=r;o.priority=t;T.messageManager.putMessage(o)}else{suncom.Logger.error("尝试添加Message消息，但模块 "+d[e]+" 己停止！！！")}}e.addMessage=c;function f(e,t,s){if(s===void 0){s=null}if(this.isModuleStopped(e)===false){T.messageManager.addCustomMessageId(e,t,s)}else{suncom.Logger.error("尝试添加自定义消息，但模块 "+d[e]+" 己停止！！！")}}e.addCustomMessageId=f;function h(e,t){if(this.isModuleStopped(e)===false){T.messageManager.removeCustomMessageId(e,t)}else{suncom.Logger.error("尝试移除自定义消息，但模块 "+d[e]+" 己停止！！！")}}e.removeCustomMessageId=h;function p(e,t,s,r,i,o,n){if(o===void 0){o=1}if(n===void 0){n=false}if(this.isModuleStopped(e)===false){return T.timerManager.addTimer(e,t,s,r,i,o,n)}else{suncom.Logger.error("尝试添加定时器，但模块 "+d[e]+" 己停止！！！")}}e.addTimer=p;function m(e){return T.timerManager.removeTimer(e)}e.removeTimer=m})(y=e.System||(e.System={}));e.var_mServices={};function _(e,t){if(this.var_mServices[e]===void 0){this.var_mServices[e]=t;t.run()}else{suncom.Logger.warn("suncore::服务己运行: "+e)}}e.runService=_;function E(e){var t=this.var_mServices[e]||null;if(t===null){suncom.Logger.warn("suncore::服务不存在: "+e)}else{delete this.var_mServices[e];t.stop()}}e.stopService=E})(suncore||(suncore={}));