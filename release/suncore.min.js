var __extends=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s))e[s]=t[s]};return i(e,t)};return function(e,t){i(e,t);function s(){this.constructor=e}e.prototype=t===null?Object.create(t):(s.prototype=t.prototype,new s)}}();var suncore;(function(e){var m;(function(e){e[e["PRIORITY_0"]=0]="PRIORITY_0";e[e["PRIORITY_HIGH"]=1]="PRIORITY_HIGH";e[e["PRIORITY_NOR"]=2]="PRIORITY_NOR";e[e["PRIORITY_LOW"]=3]="PRIORITY_LOW";e[e["PRIORITY_LAZY"]=4]="PRIORITY_LAZY";e[e["PRIORITY_TRIGGER"]=5]="PRIORITY_TRIGGER";e[e["PRIORITY_TASK"]=6]="PRIORITY_TASK";e[e["PRIORITY_PROMISE"]=7]="PRIORITY_PROMISE";e[e["E_MAX"]=8]="E_MAX"})(m=e.MessagePriorityEnum||(e.MessagePriorityEnum={}));var p;(function(e){e[e["SYSTEM"]=0]="SYSTEM";e[e["CUSTOM"]=1]="CUSTOM";e[e["TIMELINE"]=2]="TIMELINE";e[e["MAX"]=3]="MAX"})(p=e.ModuleEnum||(e.ModuleEnum={}));var r;(function(e){e[e["NSL_MSG_ID_BEGIN"]=1]="NSL_MSG_ID_BEGIN";e[e["NSL_MSG_ID_END"]=10]="NSL_MSG_ID_END";e[e["MMI_MSG_ID_BEGIN"]=10]="MMI_MSG_ID_BEGIN";e[e["MMI_MSG_ID_END"]=100]="MMI_MSG_ID_END";e[e["CUI_MSG_ID_BEGIN"]=100]="CUI_MSG_ID_BEGIN";e[e["CUI_MSG_ID_END"]=200]="CUI_MSG_ID_END";e[e["GUI_MSG_ID_BEGIN"]=200]="GUI_MSG_ID_BEGIN";e[e["GUI_MSG_ID_END"]=400]="GUI_MSG_ID_END";e[e["L4C_MSG_ID_BEGIN"]=400]="L4C_MSG_ID_BEGIN";e[e["L4C_MSG_ID_END"]=700]="L4C_MSG_ID_END"})(r=e.MsgQIdEnum||(e.MsgQIdEnum={}));var l;(function(e){e[e["E_NIL"]=-1]="E_NIL";e[e["E_KAL"]=0]="E_KAL";e[e["MMI"]=1]="MMI";e[e["L4C"]=2]="L4C";e[e["CUI"]=3]="CUI";e[e["GUI"]=4]="GUI";e[e["NSL"]=5]="NSL";e[e["E_ANY"]=6]="E_ANY"})(l=e.MsgQModEnum||(e.MsgQModEnum={}));var t=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_done=false;e.$var_running=false;return e}e.prototype.cancel=function(){};Object.defineProperty(e.prototype,"done",{get:function(){return this.$var_done},set:function(e){if(this.$var_done!==e){this.$var_done=e;if(e===true){this.cancel()}}},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"running",{get:function(){return this.$var_running},set:function(e){this.$var_running=e},enumerable:false,configurable:true});return e}(puremvc.Notifier);e.AbstractTask=t;var s=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_running=false;return e}e.prototype.run=function(){if(this.$var_running===true){suncom.Logger.warn(suncom.DebugMode.ANY,"服务["+suncom.Common.getQualifiedClassName(this)+"]己运行");return}this.$var_running=true;this.$onRun()};e.prototype.stop=function(){if(this.$var_running===false){suncom.Logger.warn(suncom.DebugMode.ANY,"服务["+suncom.Common.getQualifiedClassName(this)+"]未运行");return}this.$var_running=false;this.$onStop()};Object.defineProperty(e.prototype,"running",{get:function(){return this.$var_running},enumerable:false,configurable:true});return e}(puremvc.Notifier);e.BaseService=s;var i=function(t){__extends(e,t);function e(){var e=t.call(this,l.E_KAL)||this;e.$delta=0;e.$runTime=0;e.$localTime=Date.now();Laya.timer.frameLoop(1,e,e.$onFrameLoop);return e}e.prototype.destroy=function(){if(this.$destroyed===true){return}t.prototype.destroy.call(this);Laya.timer.clear(this,this.$onFrameLoop)};e.prototype.$onFrameLoop=function(){var e=this.$localTime;this.$localTime=Date.now();this.$delta=this.$localTime-e;if(this.$delta>0){this.$runTime+=this.$delta;this.$lapse(this.$delta)}};e.prototype.$lapse=function(e){if(E.isModulePaused(p.CUSTOM)===false){_.timeStamp.lapse(e)}if(E.isModulePaused(p.TIMELINE)===false){_.timeline.lapse(e)}this.facade.sendNotification(S.MSG_Q_BUSINESS,l.NSL);this.facade.sendNotification(S.PHYSICS_PREPARE);this.facade.sendNotification(S.PHYSICS_FRAME);_.timerManager.executeTimer();this.facade.sendNotification(S.ENTER_FRAME);_.messageManager!==null&&_.messageManager.dealMessage();_.messageManager!==null&&_.messageManager.classifyMessages0();this.facade.sendNotification(S.LATER_FRAME);this.facade.sendNotification(S.MSG_Q_BUSINESS)};e.prototype.getTime=function(){return this.$runTime};e.prototype.getDelta=function(){return this.$delta};return e}(puremvc.Notifier);e.Engine=i;var d=function(){function e(){this.mod=p.SYSTEM;this.priority=m.PRIORITY_0;this.weights=0;this.task=null;this.groupId=0;this.args=null;this.method=null;this.caller=null;this.timeout=0}e.prototype.recover=function(){this.task=null;this.args=null;this.method=null;this.caller=null;suncom.Pool.recover("suncore.Message",this)};return e}();e.Message=d;var n=function(){function e(){this.$queues=[];for(var e=0;e<p.MAX;e++){this.$queues[e]=new o(e)}}e.prototype.putMessage=function(e){this.$queues[e.mod].putMessage(e)};e.prototype.dealMessage=function(){for(var e=0;e<p.MAX;e++){if(E.isModulePaused(e)===false){this.$queues[e].dealMessage()}}};e.prototype.classifyMessages0=function(){for(var e=0;e<p.MAX;e++){if(E.isModuleStopped(e)===false){this.$queues[e].classifyMessages0()}}};e.prototype.clearMessages=function(e){this.$queues[e].clearMessages()};e.prototype.cancelTaskByGroupId=function(e,t){this.$queues[e].cancelTaskByGroupId(e,t)};return e}();e.MessageManager=n;var o=function(){function e(e){this.$tasks=[];this.$queues=[];this.$messages0=[];this.$canceled=false;this.$weights=0;this.$mod=e;for(var t=0;t<m.E_MAX;t++){this.$queues[t]=[]}}e.prototype.putMessage=function(e){this.$messages0.push(e);if(e.priority===m.PRIORITY_PROMISE){this.$initPromiseWeights(e)}};e.prototype.$initPromiseWeights=function(e){var t=this.$queues[m.PRIORITY_PROMISE];if(t.length===0){e.weights=this.$weights}else{var s=t[0];if(s.task.running===false){e.weights=this.$weights}else{e.weights=this.$weights=t[0].weights+1}}};e.prototype.dealMessage=function(){var e=0;var t=0;for(var s=0;s<m.E_MAX;s++){var i=void 0;if(s===m.PRIORITY_TASK){i=this.$tasks}else{i=this.$queues[s]}if(i.length===0||s===m.PRIORITY_LAZY){continue}if(s===m.PRIORITY_TASK){for(var r=this.$tasks.length-1;r>-1;r--){var n=this.$tasks[r];if(n.length>0&&this.$dealTaskMessage(n[0])===true){n.shift().recover();e++}if(n.length>1){t+=n.length-1}else if(n.length===0){this.$tasks.splice(r,1)}}}else if(s===m.PRIORITY_PROMISE){while(i.length>0){e++;var o=i[0];if(this.$dealTaskMessage(o)===false){break}i.shift().recover();if(this.$weights>o.weights){break}}}else if(s===m.PRIORITY_TRIGGER){while(i.length>0&&this.$dealTriggerMessage(i[0])===true){i.shift().recover();if(this.$canceled===false){e++}}}else{var a=0;var u=this.$getDealCountByPriority(s);for(;i.length>0&&(u===0||a<u);a++){var l=i.shift();if(this.$dealCustomMessage(l)===false){a--}l.recover()}e+=a}t+=i.length}if(t===0&&e===0&&this.$messages0.length===0){var i=this.$queues[m.PRIORITY_LAZY];if(i.length>0){var l=i.shift();this.$dealCustomMessage(l);e++;l.recover()}}};e.prototype.$dealTaskMessage=function(e){var t=e.task;if(t.running===false){t.running=true;if(t.run()===true){t.done=true}}return t.done===true};e.prototype.$dealTriggerMessage=function(e){if(e.timeout>E.getModuleTimestamp(this.$mod)){return false}this.$canceled=e.method.apply(e.caller,e.args)===false;return true};e.prototype.$dealCustomMessage=function(e){return e.method.apply(e.caller,e.args)!==false};e.prototype.$getDealCountByPriority=function(e){if(e===m.PRIORITY_0){return 0}if(e===m.PRIORITY_HIGH){return 10}if(e===m.PRIORITY_NOR){return 3}if(e===m.PRIORITY_LOW){return 1}throw Error("错误的消息优先级")};e.prototype.classifyMessages0=function(){while(this.$messages0.length>0){var e=this.$messages0.shift();if(e.priority===m.PRIORITY_TASK){this.$addTaskMessage(e)}else if(e.priority===m.PRIORITY_TRIGGER){this.$addTriggerMessage(e)}else if(e.priority===m.PRIORITY_PROMISE){this.$addPromiseMessage(e)}else{this.$queues[e.priority].push(e)}}};e.prototype.$addPromiseMessage=function(e){var t=this.$queues[m.PRIORITY_PROMISE];var s=-1;for(var i=0;i<t.length;i++){var r=t[i];if(r.task.running===true){continue}if(r.weights<e.weights){s=i;break}}if(s===-1){t.push(e)}else{t.splice(s,0,e)}};e.prototype.$addTriggerMessage=function(e){var t=this.$queues[m.PRIORITY_TRIGGER];var s=0;var i=0;var r=t.length-1;var n=-1;while(r-s>1){i=Math.floor((s+r)*.5);if(t[i].timeout<=e.timeout){s=i}else if(t[i].timeout>e.timeout){r=i}else{break}}for(var o=s;o<=r;o++){if(t[o].timeout>e.timeout){n=o;break}}if(n<0){t.push(e)}else{t.splice(n,0,e)}};e.prototype.$addTaskMessage=function(e){var t=-1;for(var s=0;s<this.$tasks.length;s++){var i=this.$tasks[s];if(i.length>0&&i[0].groupId===e.groupId){t=s;break}}if(t===-1){this.$tasks.unshift([e])}else{this.$tasks[t].push(e)}};e.prototype.clearMessages=function(){while(this.$messages0.length>0){this.$cancelMessage(this.$messages0.shift())}for(var e=0;e<this.$tasks.length;e++){var t=this.$tasks[e];while(t.length>0){this.$cancelMessage(t.shift())}}for(var s=0;s<m.E_MAX;s++){var i=this.$queues[s];while(i.length>0){this.$cancelMessage(i.shift())}}};e.prototype.$cancelMessage=function(e){if(e.priority===m.PRIORITY_TASK){e.task.done=true}e.recover()};e.prototype.cancelTaskByGroupId=function(e,t){for(var s=0;s<this.$tasks.length;s++){var i=this.$tasks[s];if(i.length>0&&i[0].groupId===t){while(i.length>0){var r=i.shift();r.task.done=true;r.recover()}break}}};return e}();e.MessageQueue=o;var f=function(){function e(){this.dst=l.E_ANY;this.id=0;this.data=null;this.batchIndex=0}e.prototype.setTo=function(e,t,s,i){this.id=t;this.dst=e;this.data=s;this.batchIndex=i;return this};e.prototype.recover=function(){this.data=null;suncom.Pool.recover("suncore.MsgQMsg",this)};return e}();e.MsgQMsg=f;var a=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$onRun=function(){v.setModuleActive(this.msgQMod,true);this.facade.registerObserver(S.MSG_Q_BUSINESS,this.$func_onMsgQBusiness,this)};t.prototype.$onStop=function(){v.setModuleActive(this.msgQMod,false);this.facade.removeObserver(S.MSG_Q_BUSINESS,this.$func_onMsgQBusiness,this)};t.prototype.$func_onMsgQBusiness=function(e){var t=null;if(e===void 0||e===this.msgQMod){while(true){if(e===l.NSL){t=v.fetch(l.NSL,2)}else if(this.msgQMod===l.NSL){t=v.fetch(l.NSL,1)}else{t=v.fetch(this.msgQMod)}if(t===null){break}this.$dealMsgQMsg(t.id,t.data);t.recover()}v.batchIndex++}};return t}(s);e.MsgQService=a;var u=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t){if(t!==true&&t!==false){throw Error("参数stop应当为布尔值")}if(t===true){if(E.isModuleStopped(e)===true){suncom.Logger.error(suncom.DebugMode.ANY,"模块 "+p[e]+" 己经停止！！！");return}}else if(E.isModulePaused(e)===true){suncom.Logger.error(suncom.DebugMode.ANY,"模块 "+p[e]+" 己经暂停！！！");return}else if(e===p.SYSTEM){suncom.Logger.error(suncom.DebugMode.ANY,"无法暂停 "+p[e]+" 模块！！！");return}if(e===p.TIMELINE){_.timeline.pause(t)}else if(e===p.CUSTOM){_.timeStamp.pause(t)}if(t===false){return}if(e===p.SYSTEM){if(E.isModuleStopped(p.TIMELINE)===false||E.isModuleStopped(p.CUSTOM)===false){suncom.Logger.error(suncom.DebugMode.ANY,"SYSTEM 不能停止因为 CUSTOM 或 TIMELINE 依然在运行")}}_.timerManager.clearTimer(e);_.messageManager.clearMessages(e);if(e===p.TIMELINE){_.timeline=null}else if(e===p.CUSTOM){_.timeStamp=null}else{_.engine.destroy();_.engine=null}if(e===p.SYSTEM){_.timerManager=null;_.messageManager=null}};return t}(puremvc.SimpleCommand);e.PauseTimelineCommand=u;var c=function(r){__extends(e,r);function e(e,t,s){if(s===void 0){s=null}var i=r.call(this)||this;i.$var_args=null;i.$var_caller=null;i.$var_method=null;i.$var_args=s;i.$var_caller=e;i.$var_method=t;return i}e.prototype.run=function(){this.$var_method.apply(this.$var_caller,this.$var_args);return true};return e}(t);e.SimpleTask=c;var h=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t){if(t!==true&&t!==false){throw Error("参数pause应当为布尔值")}if(E.isModulePaused(e)===false){suncom.Logger.error(suncom.DebugMode.ANY,"模块 "+p[e]+" 己经启动！！！");return}if(e===p.SYSTEM&&_.engine===null){_.timerManager=new M;_.messageManager=new n}if(e===p.TIMELINE){if(_.timeline===null){_.timeline=new g}_.timeline.resume(t)}else if(e===p.CUSTOM){if(_.timeStamp===null){_.timeStamp=new g}_.timeStamp.resume(t)}else if(e===p.SYSTEM){if(_.engine===null){_.engine=new i}}};return t}(puremvc.SimpleCommand);e.StartTimelineCommand=h;var g=function(){function e(){this.$runTime=0;this.$paused=true;this.$stopped=true}e.prototype.lapse=function(e){this.$runTime+=e};e.prototype.pause=function(e){this.$paused=true;this.$stopped=e};e.prototype.resume=function(e){this.$paused=e;this.$stopped=false};e.prototype.getTime=function(){return this.$runTime};Object.defineProperty(e.prototype,"paused",{get:function(){return this.$paused},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"stopped",{get:function(){return this.$stopped},enumerable:false,configurable:true});return e}();e.Timeline=g;var T=function(){function e(){this.mod=p.SYSTEM;this.active=false;this.delay=0;this.method=null;this.caller=null;this.args=null;this.real=false;this.count=0;this.loops=1;this.timerId=0;this.timestamp=-1;this.timeout=0}e.prototype.recover=function(){this.method=null;this.caller=null;this.args=null;suncom.Pool.recover("suncore.Timer",this)};return e}();e.Timer=T;var M=function(){function e(){this.$timers=[];this.$timerMap={};for(var e=0;e<p.MAX;e++){this.$timers[e]=[]}}e.prototype.executeTimer=function(){for(var e=0;e<p.MAX;e++){if(E.isModulePaused(e)===false){var t=this.$timers[e];var s=E.getModuleTimestamp(e);while(t.length>0){var i=t[0];if(i.active===true){if(i.timeout>s){break}if(i.real===true){i.count++}else{i.count=Math.min(Math.floor((s-i.timestamp)/i.delay),i.loops)}}var r=false;if(i.active===false||i.loops>0&&i.count>=i.loops){delete this.$timerMap[i.timerId]}else{this.addTimer(i.mod,i.delay,i.method,i.caller,i.args,i.loops,i.real,i.timerId,i.timestamp,i.timeout,i.count)}t.shift();if(i.active===true){if(i.args===null){i.method.call(i.caller,i.count,i.loops)}else{i.method.apply(i.caller,i.args.concat(i.count,i.loops))}}i.recover()}}}};e.prototype.addTimer=function(e,t,s,i,r,n,o,a,u,l,f){if(r===void 0){r=null}if(n===void 0){n=1}if(o===void 0){o=false}if(a===void 0){a=0}if(u===void 0){u=-1}if(l===void 0){l=-1}if(f===void 0){f=0}var c=E.getModuleTimestamp(e);if(a===0){a=suncom.Common.createHashId()}if(u===-1){u=c}if(l===-1){l=c}var h;if(typeof t==="number"){h=t}else{h=t[1]||0;t=t[0]}if(t<1){t=1}var g=0;if(o===true){g=(c-l)%t}else{g=(c-u)%t}l=c+t-g;if(h===0){if(r===null){s.call(i,0,n)}else{s.apply(i,r.concat(0,n))}}else if(h<t){var m=t-h;l=suncom.Mathf.clamp(l-m,c+1,l)}var p=suncom.Pool.getItemByClass("suncore.Timer",T);p.mod=e;p.active=true;p.delay=t;p.method=s;p.caller=i;p.args=r;p.real=o;p.count=f;p.loops=n;p.timerId=a;p.timestamp=u;p.timeout=l;var d=this.$timers[e];var M=-1;var I=0;var _=0;var v=d.length-1;while(v-I>1){_=Math.floor((I+v)*.5);if(d[_].timeout<=l){I=_}else if(d[_].timeout>l){v=_}else{break}}for(var S=I;S<=v;S++){if(d[S].timeout>l){M=S;break}}if(M<0){d.push(p)}else{d.splice(M,0,p)}this.$timerMap[a]=p;return a};e.prototype.removeTimer=function(e){if(e>0&&this.$timerMap[e]!==void 0){this.$timerMap[e].active=false}return 0};e.prototype.clearTimer=function(e){var t=this.$timers[e];while(t.length>0){var s=t.pop();delete this.$timerMap[s.timerId];s.recover()}};return e}();e.TimerManager=M;var I=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(){var e=this.$resolve.bind(this);this.$var_method.apply(this.$var_caller,this.$var_args===null?[e]:[e].concat(this.$var_args));return this.done};t.prototype.$resolve=function(){this.done=true};return t}(c);e.PromiseTask=I;var _;(function(e){e.engine=null;e.timeline=null;e.timeStamp=null;e.timerManager=null;e.messageManager=null})(_=e.M||(e.M={}));var v;(function(n){var o={};var i={};n.batchIndex=1;function e(e,t,s){if(u(e)===false){suncom.Logger.warn(suncom.DebugMode.ANY,"消息发送失败，模块己暂停 mod:"+l[e]);return}if(a(e,t)===false){suncom.Logger.warn(suncom.DebugMode.ANY,"消息发送失败，消息ID非法 mod:"+e+", id:"+t);return}var i=o[e];if(i===void 0){i=o[e]=[]}var r=suncom.Pool.getItemByClass("suncore.MsgQMsg",f);i.push(r.setTo(e,t,s,n.batchIndex))}n.send=e;function t(e,t){var s=o[e];if(s===void 0||s.length===0){return null}for(var i=0;i<s.length;i++){var r=s[i];if(e===l.NSL||r.batchIndex<n.batchIndex){if(t===void 0||r.id===t){s.splice(i,1);return r}}}return null}n.fetch=t;function a(e,t){var s=suncom.Mathf.MIN_SAFE_INTEGER;var i=suncom.Mathf.MAX_SAFE_INTEGER;if(e===l.MMI){s=r.MMI_MSG_ID_BEGIN;i=r.MMI_MSG_ID_END}else if(e===l.CUI){s=r.CUI_MSG_ID_BEGIN;i=r.CUI_MSG_ID_END}else if(e===l.GUI){s=r.GUI_MSG_ID_BEGIN;i=r.GUI_MSG_ID_END}else if(e===l.L4C){s=r.L4C_MSG_ID_BEGIN;i=r.L4C_MSG_ID_END}else if(e===l.NSL){s=r.NSL_MSG_ID_BEGIN;i=r.NSL_MSG_ID_END}else{throw Error("未知的消息范围 mod:"+e)}return t>=s&&t<i}function u(e){return i[e]===true}n.isModuleActive=u;function s(e,t){i[e]=t;if(t===false){var s=o[e]||[];while(s.length>0){s.pop().recover()}delete o[e]}}n.setModuleActive=s})(v=e.MsgQ||(e.MsgQ={}));var S;(function(e){e.STARTUP="suncore.NotifyKey.STARTUP";e.SHUTDOWN="suncore.NotifyKey.SHUTDOWN";e.START_TIMELINE="suncore.NotifyKey.START_TIMELINE";e.PAUSE_TIMELINE="suncore.NotifyKey.PAUSE_TIMELINE";e.PHYSICS_FRAME="suncore.NotifyKey.PHYSICS_FRAME";e.PHYSICS_PREPARE="suncore.NotifyKey.PHYSICS_PREPARE";e.ENTER_FRAME="suncore.NotifyKey.ENTER_FRAME";e.LATER_FRAME="suncore.NotifyKey.LATER_FRAME";e.MSG_Q_BUSINESS="suncore.NotifyKey.MSG_Q_BUSINESS"})(S=e.NotifyKey||(e.NotifyKey={}));var E;(function(a){var e=1e3;function r(){e++;return e}function t(e){if(e===p.TIMELINE){if(_.timeline===null||_.timeline.stopped===true){return true}}else if(e===p.CUSTOM){if(_.timeStamp===null||_.timeStamp.stopped===true){return true}}else if(_.engine===null){return true}return false}a.isModuleStopped=t;function s(e){if(t(e)===true){return true}if(e===p.TIMELINE){return _.timeline.paused}else if(e===p.CUSTOM){return _.timeStamp.paused}return false}a.isModulePaused=s;function i(){if(t(p.SYSTEM)===false){return _.engine.getDelta()}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试获取帧时间间隔，但系统模块己停止！！！")}}a.getDelta=i;function n(e){if(t(e)===false){if(e===p.TIMELINE){return _.timeline.getTime()}else if(e===p.CUSTOM){return _.timeStamp.getTime()}return _.engine.getTime()}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试获取时间戳，但模块 "+p[e]+" 己停止！！！")}}a.getModuleTimestamp=n;function o(e,t,s){if(s===void 0){s=0}if(a.isModuleStopped(e)===false){if(s===-1){s=r()}else if(s>1e3){throw Error("自定义的Task GroupId不允许超过1000")}var i=suncom.Pool.getItemByClass("suncore.Message",d);i.mod=e;i.task=t;i.groupId=s;i.priority=m.PRIORITY_TASK;_.messageManager.putMessage(i)}else{s=-1;suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加任务，但模块 "+p[e]+" 己停止！！！")}return s}a.addTask=o;function u(e,t){_.messageManager.cancelTaskByGroupId(e,t)}a.cancelTaskByGroupId=u;function l(e,t,s,i,r){if(r===void 0){r=null}if(a.isModuleStopped(e)===false){var n=suncom.Pool.getItemByClass("suncore.Message",d);n.mod=e;n.args=r;n.caller=s;n.method=i;n.timeout=a.getModuleTimestamp(e)+t;n.priority=m.PRIORITY_TRIGGER;_.messageManager.putMessage(n)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加触发器，但模块 "+p[e]+" 己停止！！！")}}a.addTrigger=l;function f(e,t,s,i){if(i===void 0){i=null}if(a.isModuleStopped(e)===false){var r=suncom.Pool.getItemByClass("suncore.Message",d);r.mod=e;r.task=new I(t,s,i);r.priority=m.PRIORITY_PROMISE;_.messageManager.putMessage(r)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加Promise消息，但模块 "+p[e]+" 己停止！！！")}}a.addPromise=f;function c(e,t,s,i,r){if(r===void 0){r=null}if(a.isModuleStopped(e)===false){var n=suncom.Pool.getItemByClass("suncore.Message",d);n.mod=e;n.args=r;n.caller=s;n.method=i;n.priority=t;_.messageManager.putMessage(n)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加Message消息，但模块 "+p[e]+" 己停止！！！")}}a.addMessage=c;function h(e,t,s,i,r,n,o){if(n===void 0){n=1}if(o===void 0){o=false}if(a.isModuleStopped(e)===false){return _.timerManager.addTimer(e,t,s,i,r,n,o)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加定时器，但模块 "+p[e]+" 己停止！！！")}}a.addTimer=h;function g(e){return _.timerManager.removeTimer(e)}a.removeTimer=g})(E=e.System||(e.System={}))})(suncore||(suncore={}));