var __extends=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();var suncore;(function(r){var l;(function(e){e[e["MIN"]=0]="MIN";e[e["PRIORITY_0"]=1]="PRIORITY_0";e[e["PRIORITY_HIGH"]=2]="PRIORITY_HIGH";e[e["PRIORITY_NOR"]=3]="PRIORITY_NOR";e[e["PRIORITY_LOW"]=4]="PRIORITY_LOW";e[e["PRIORITY_LAZY"]=5]="PRIORITY_LAZY";e[e["PRIORITY_TRIGGER"]=6]="PRIORITY_TRIGGER";e[e["PRIORITY_TASK"]=7]="PRIORITY_TASK";e[e["MAX"]=8]="MAX"})(l=r.MessagePriorityEnum||(r.MessagePriorityEnum={}));var c;(function(e){e[e["MIN"]=0]="MIN";e[e["SYSTEM"]=0]="SYSTEM";e[e["CUSTOM"]=1]="CUSTOM";e[e["TIMELINE"]=2]="TIMELINE";e[e["MAX"]=3]="MAX"})(c=r.ModuleEnum||(r.ModuleEnum={}));var s;(function(e){e[e["NSL_MSG_ID_BEGIN"]=1]="NSL_MSG_ID_BEGIN";e[e["NSL_MSG_ID_END"]=10]="NSL_MSG_ID_END";e[e["MMI_MSG_ID_BEGIN"]=10]="MMI_MSG_ID_BEGIN";e[e["MMI_MSG_ID_END"]=100]="MMI_MSG_ID_END";e[e["CUI_MSG_ID_BEGIN"]=100]="CUI_MSG_ID_BEGIN";e[e["CUI_MSG_ID_END"]=200]="CUI_MSG_ID_END";e[e["GUI_MSG_ID_BEGIN"]=200]="GUI_MSG_ID_BEGIN";e[e["GUI_MSG_ID_END"]=400]="GUI_MSG_ID_END";e[e["L4C_MSG_ID_BEGIN"]=400]="L4C_MSG_ID_BEGIN";e[e["L4C_MSG_ID_END"]=700]="L4C_MSG_ID_END"})(s=r.MsgQIdEnum||(r.MsgQIdEnum={}));var h;(function(e){e[e["NIL"]=-1]="NIL";e[e["KAL"]=0]="KAL";e[e["MMI"]=1]="MMI";e[e["CUI"]=2]="CUI";e[e["GUI"]=3]="GUI";e[e["L4C"]=4]="L4C";e[e["NSL"]=5]="NSL";e[e["ANY"]=6]="ANY"})(h=r.MsgQModEnum||(r.MsgQModEnum={}));var e=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$done=false;e.$running=false;return e}e.prototype.cancel=function(){};Object.defineProperty(e.prototype,"done",{get:function(){return this.$done},set:function(e){if(this.$done!==e){this.$done=e;if(e===true){this.cancel()}}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"running",{get:function(){return this.$running},set:function(e){this.$running=e},enumerable:true,configurable:true});return e}(puremvc.Notifier);r.AbstractTask=e;var t=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$running=false;return e}e.prototype.run=function(){if(this.$running===true){console.warn("服务["+suncom.Common.getQualifiedClassName(this)+"]己运行");return}this.$running=true;this.$onRun();if(this.facade.hasObserver(u.ENTER_FRAME,null,this)===true){throw Error("请重写$frameLoop方法来替代ENTER_FRAME事件")}if(this.$running===true&&this.$frameLoop!==e.prototype.$frameLoop){this.facade.registerObserver(u.ENTER_FRAME,this.$onEnterFrame,this)}};e.prototype.stop=function(){if(this.$running===false){console.warn("服务["+suncom.Common.getQualifiedClassName(this)+"]未运行");return}this.$running=false;this.$onStop();if(this.$running===false&&this.$frameLoop!==e.prototype.$frameLoop){this.facade.removeObserver(u.ENTER_FRAME,this.$onEnterFrame,this)}};e.prototype.$onEnterFrame=function(){if(this.$running===true){this.$frameLoop()}};e.prototype.$frameLoop=function(){};Object.defineProperty(e.prototype,"running",{get:function(){return this.$running},enumerable:true,configurable:true});return e}(puremvc.Notifier);r.BaseService=t;var i=function(t){__extends(e,t);function e(){var e=t.call(this,h.KAL)||this;e.$delta=0;e.$runTime=0;e.$localTime=(new Date).valueOf();Laya.timer.frameLoop(1,e,e.$onFrameLoop);return e}e.prototype.destroy=function(){Laya.timer.clear(this,this.$onFrameLoop)};e.prototype.$onFrameLoop=function(){var e=this.$localTime;this.$localTime=(new Date).valueOf();this.$delta=this.$localTime-e;if(this.$delta>0){this.$runTime+=this.$delta;this.$lapse(this.$delta)}};e.prototype.$lapse=function(e){if($.isModulePaused(c.CUSTOM)===false){I.timeStamp.lapse(e)}if($.isModulePaused(c.TIMELINE)===false){I.timeline.lapse(e)}this.facade.sendNotification(u.MSG_Q_BUSINESS,h.NSL);this.facade.sendNotification(u.PHYSICS_PREPARE);this.facade.sendNotification(u.PHYSICS_FRAME);I.timerManager.executeTimer();this.facade.sendNotification(u.ENTER_FRAME);I.messageManager.dealMessage();I.messageManager.classifyMessages0();this.facade.sendNotification(u.LATER_FRAME);this.facade.sendNotification(u.MSG_Q_BUSINESS)};e.prototype.getTime=function(){return this.$runTime};e.prototype.getDelta=function(){return this.$delta};return e}(puremvc.Notifier);r.Engine=i;var n=function(){function e(){this.$queues=[];for(var e=c.MIN;e<c.MAX;e++){this.$queues[e]=new o(e)}}e.prototype.putMessage=function(e){this.$queues[e.mod].putMessage(e)};e.prototype.dealMessage=function(){for(var e=c.MIN;e<c.MAX;e++){if($.isModulePaused(e)===false){this.$queues[e].dealMessage()}}};e.prototype.classifyMessages0=function(){for(var e=c.MIN;e<c.MAX;e++){if($.isModuleStopped(e)===false){this.$queues[e].classifyMessages0()}}};e.prototype.clearMessages=function(e){this.$queues[e].clearMessages()};e.prototype.cancelTaskByGroupId=function(e,t){this.$queues[e].cancelTaskByGroupId(e,t)};return e}();r.MessageManager=n;var o=function(){function e(e){this.$tasks=[];this.$queues=[];this.$messages0=[];this.$mod=e;for(var t=l.MIN;t<l.MAX;t++){this.$queues[t]=[]}}e.prototype.putMessage=function(e){this.$messages0.push(e)};e.prototype.dealMessage=function(){var e=0;var t=0;for(var r=l.MIN;r<l.MAX;r++){var i=void 0;if(r===l.PRIORITY_TASK){i=this.$tasks}else{i=this.$queues[r]}if(i.length===0||r===l.PRIORITY_LAZY){continue}if(r===l.PRIORITY_TASK){for(var s=this.$tasks.length-1;s>-1;s--){var n=this.$tasks[s];if(n.length>0&&this.$dealTaskMessage(n[0])===true){n.shift();e++}if(n.length>1){t+=n.length-1}else if(n.length===0){this.$tasks.splice(s,1)}}}else if(r===l.PRIORITY_TRIGGER){var o={canceled:false};while(i.length>0&&this.$dealTriggerMessage(i[0],o)===true){i.shift();if(o.canceled===false){e++}}}else{var a=0;var u=this.$getDealCountByPriority(r);for(;i.length>0&&(u===0||a<u);a++){if(this.$dealCustomMessage(i.shift())===false){a--}}e+=a}t+=i.length}if(t===0&&e===0&&this.$messages0.length===0){var i=this.$queues[l.PRIORITY_LAZY];if(i.length>0){this.$dealCustomMessage(i.shift());e++}}};e.prototype.$dealTaskMessage=function(e){var t=e.task;if(t.running===false){t.running=true;if(t.run()===true){t.done=true}}return t.done===true};e.prototype.$dealTriggerMessage=function(e,t){if(e.timeout>$.getModuleTimestamp(this.$mod)){return false}t.canceled=e.handler.run()===false;return true};e.prototype.$dealCustomMessage=function(e){return e.handler.run()!==false};e.prototype.$getDealCountByPriority=function(e){if(e===l.PRIORITY_0){return 0}if(e===l.PRIORITY_HIGH){return 10}if(e===l.PRIORITY_NOR){return 3}if(e===l.PRIORITY_LOW){return 1}throw Error("错误的消息优先级")};e.prototype.classifyMessages0=function(){while(this.$messages0.length){var e=this.$messages0.shift();if(e.priority===l.PRIORITY_TASK){this.$addTaskMessage(e)}else if(e.priority===l.PRIORITY_TRIGGER){this.$addTriggerMessage(e)}else{this.$queues[e.priority].push(e)}}};e.prototype.$addTriggerMessage=function(e){var t=this.$queues[l.PRIORITY_TRIGGER];var r=0;var i=0;var s=t.length-1;var n=-1;while(s-r>1){i=Math.floor((r+s)*.5);if(t[i].timeout<=e.timeout){r=i}else if(t[i].timeout>e.timeout){s=i}else{break}}for(var o=r;o<=s;o++){if(t[o].timeout>e.timeout){n=o;break}}if(n<0){t.push(e)}else{t.splice(n,0,e)}};e.prototype.$addTaskMessage=function(e){var t=-1;for(var r=0;r<this.$tasks.length;r++){var i=this.$tasks[r];if(i.length>0&&i[0].groupId===e.groupId){t=r;break}}if(t===-1){this.$tasks.unshift([e])}else{this.$tasks[t].push(e)}};e.prototype.clearMessages=function(){while(this.$messages0.length>0){this.$cancelMessage(this.$messages0.shift())}for(var e=0;e<this.$tasks.length;e++){var t=this.$tasks[e];while(t.length>0){this.$cancelMessage(t.shift())}}for(var r=l.MIN;r<l.MAX;r++){var i=this.$queues[r];while(i.length>0){this.$cancelMessage(i.shift())}}};e.prototype.$cancelMessage=function(e){if(e.priority===l.PRIORITY_TASK){e.task.done=true}};e.prototype.cancelTaskByGroupId=function(e,t){for(var r=0;r<this.$tasks.length;r++){var i=this.$tasks[r];if(i[0].groupId===t){while(i.length>0){i.shift().task.done=true}break}}};return e}();r.MessageQueue=o;var a=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$onRun=function(){m.setModuleActive(this.msgQMod,true);this.facade.registerObserver(u.MSG_Q_BUSINESS,this.$onMsgQBusiness,this)};t.prototype.$onStop=function(){m.setModuleActive(this.msgQMod,false);this.facade.removeObserver(u.MSG_Q_BUSINESS,this.$onMsgQBusiness,this)};t.prototype.$onMsgQBusiness=function(e){var t=null;if(e===void 0||e===this.msgQMod){while(true){if(e===h.NSL){t=m.fetch(h.NSL,2)}else if(this.msgQMod===h.NSL){t=m.fetch(h.NSL,1)}else{t=m.fetch(this.msgQMod)}if(t===null){break}this.$dealMsgQMsg(t)}m.seqId++}};return t}(t);r.MsgQService=a;var p=function(){function s(){this.$actMsgQMod=h.NIL;this.$curMsgQMod=h.NIL;this.$target={};this.$snapshots=[]}s.prototype.asserts=function(e,t){if(e===h.KAL){return}if(this.$curMsgQMod===h.NIL||this.$curMsgQMod===h.KAL){return}if(this.$curMsgQMod===h.MMI){if(e===h.MMI||_.mmiMsgQMap[e]===true){return}}else if(this.$curMsgQMod===e){return}else if(e===h.MMI&&_.mmiMsgQMap[this.$curMsgQMod]===true){return}if(t===null){throw Error("禁止跨模块传递消息，src:"+r.MsgQModEnum[this.$curMsgQMod]+", dest:"+r.MsgQModEnum[e])}else{throw Error("禁止跨模块监听消息，src:"+r.MsgQModEnum[this.$curMsgQMod]+", dest:"+r.MsgQModEnum[e])}};s.prototype.update=function(e){this.$target=e;if(e instanceof puremvc.Notifier){this.$actMsgQMod=e.msgQMod}else{this.$actMsgQMod=h.MMI}var t=e[s.MUTEX_PREFIX_KEY]||null;if(t===null){this.$curMsgQMod=this.$actMsgQMod}else{this.$curMsgQMod=_.msgQMap[t]}};s.prototype.lock=function(e){var t=this.$target[s.MUTEX_REFERENCE_KAL]||0;var r=this.$target[s.MUTEX_REFERENCE_MMI]||0;var i=this.$target[s.MUTEX_REFERENCE_ANY]||0;if(e===h.KAL){t++}else if(e===h.MMI){r++}else{i++}if(this.$curMsgQMod===h.NIL||this.$curMsgQMod===h.KAL){this.$curMsgQMod=e}else if(this.$curMsgQMod===h.MMI&&e!==h.KAL){this.$curMsgQMod=e}this.$cache(t,r,i,false)};s.prototype.unlock=function(e){var t=this.$target[s.MUTEX_REFERENCE_KAL]||0;var r=this.$target[s.MUTEX_REFERENCE_MMI]||0;var i=this.$target[s.MUTEX_REFERENCE_ANY]||0;if(e===h.KAL){t--}else if(e===h.MMI){r--}else{i--}if(t<0||r<0||i<0){throw Error("互斥体释放错误：KAL["+t+"], MMI["+r+"], ANY["+i+"]")}if(this.$curMsgQMod===this.$actMsgQMod){}else if(i>0){}else if(r>0){this.$curMsgQMod=h.MMI}else if(t>0){this.$curMsgQMod=h.KAL}else{this.$curMsgQMod=this.$actMsgQMod}this.$cache(t,r,i,true)};s.prototype.active=function(e){if(this.$actMsgQMod===h.NIL){this.$actMsgQMod=this.$curMsgQMod=e}};s.prototype.deactive=function(){var e=this.$target[s.MUTEX_REFERENCE_KAL]||0;var t=this.$target[s.MUTEX_REFERENCE_MMI]||0;var r=this.$target[s.MUTEX_REFERENCE_ANY]||0;if(e===0&&t===0&&r===0){this.$actMsgQMod=this.$curMsgQMod=h.NIL}};s.prototype.$cache=function(e,t,r,i){if(e>0){this.$target[s.MUTEX_REFERENCE_KAL]=e}else if(i===true&&this.$target[s.MUTEX_REFERENCE_KAL]>0){delete this.$target[s.MUTEX_REFERENCE_KAL]}if(t>0){this.$target[s.MUTEX_REFERENCE_MMI]=t}else if(i===true&&this.$target[s.MUTEX_REFERENCE_MMI]>0){delete this.$target[s.MUTEX_REFERENCE_MMI]}if(r>0){this.$target[s.MUTEX_PREFIX_KEY]=_.msgQCmd[this.$curMsgQMod];this.$target[s.MUTEX_REFERENCE_ANY]=r}else if(i===true&&this.$target[s.MUTEX_REFERENCE_ANY]>0){delete this.$target[s.MUTEX_PREFIX_KEY];delete this.$target[s.MUTEX_REFERENCE_ANY]}};s.prototype.backup=function(e){var t=null;if(e instanceof puremvc.Notifier){t=e.msgQMod}else{t=h.MMI}if(t!==this.$curMsgQMod){var r={data:this.$target,actMsgQMod:this.$actMsgQMod,curMsgQMod:this.$curMsgQMod};this.$snapshots.push(r);this.$target={};this.$actMsgQMod=this.$curMsgQMod=t}else{this.$snapshots.push(null)}};s.prototype.restore=function(){var e=this.$snapshots.pop()||null;if(e!==null){this.$target=e.data;this.$actMsgQMod=e.actMsgQMod;this.$curMsgQMod=e.curMsgQMod}};Object.defineProperty(s.prototype,"curMsgQMod",{get:function(){return this.$curMsgQMod},enumerable:true,configurable:true});s.MUTEX_PREFIX_KEY="suncore$mutex$prefix";s.MUTEX_REFERENCE_KAL="suncore$mutex$reference$kal";s.MUTEX_REFERENCE_MMI="suncore$mutex$reference$mmi";s.MUTEX_REFERENCE_ANY="suncore$mutex$reference$any";return s}();r.MutexLocker=p;var u=function(){function e(){}e.STARTUP="suncore.NotifyKey.STARTUP";e.SHUTDOWN="suncore.NotifyKey.SHUTDOWN";e.START_TIMELINE="suncore.NotifyKey.START_TIMELINE";e.PAUSE_TIMELINE="suncore.NotifyKey.PAUSE_TIMELINE";e.PHYSICS_FRAME="suncore.NotifyKey.PHYSICS_FRAME";e.PHYSICS_PREPARE="suncore.NotifyKey.PHYSICS_PREPARE";e.ENTER_FRAME="suncore.NotifyKey.ENTER_FRAME";e.LATER_FRAME="suncore.NotifyKey.LATER_FRAME";e.MSG_Q_BUSINESS="suncore.NotifyKey.MSG_Q_BUSINESS";return e}();r.NotifyKey=u;var f=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t){if(t===void 0){throw Error("应当为参数 stop 指定有效值")}if(t===true){if($.isModuleStopped(e)===true){console.error("模块 "+c[e]+" 己经停止！！！");return}}else if($.isModulePaused(e)===true){console.error("模块 "+c[e]+" 己经暂停！！！");return}else if(e===c.SYSTEM){console.error("无法暂停 "+c[e]+" 模块！！！");return}if(e===c.TIMELINE){I.timeline.pause(t)}else if(e===c.CUSTOM){I.timeStamp.pause(t)}if(t===false){return}if(e===c.SYSTEM){if($.isModuleStopped(c.TIMELINE)===false||$.isModuleStopped(c.CUSTOM)===false){throw Error("SYSTEM 不能停止因为 CUSTOM 或 TIMELINE 依然在运行")}}I.timerManager.clearTimer(e);I.messageManager.clearMessages(e);if(e===c.TIMELINE){I.timeline=null}else if(e===c.CUSTOM){I.timeStamp=null}else{I.engine.destroy();I.engine=null}if(e===c.SYSTEM){I.timerManager=null;I.messageManager=null}};return t}(puremvc.SimpleCommand);r.PauseTimelineCommand=f;var M=function(r){__extends(e,r);function e(e){var t=r.call(this)||this;t.$handler=e;return t}e.prototype.run=function(){this.$handler.run();return true};return e}(e);r.SimpleTask=M;var d=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t){if(t===void 0){throw Error("应当为参数 pause 指定有效值")}if($.isModulePaused(e)===false){console.error("模块 "+c[e]+" 己经启动！！！");return}if(e===c.SYSTEM&&I.engine===null){I.timerManager=new E;I.messageManager=new n}if(e===c.TIMELINE){if(I.timeline===null){I.timeline=new g}I.timeline.resume(t)}else if(e===c.CUSTOM){if(I.timeStamp===null){I.timeStamp=new g}I.timeStamp.resume(t)}else if(e===c.SYSTEM){if(I.engine===null){I.engine=new i}}};return t}(puremvc.SimpleCommand);r.StartTimelineCommand=d;var g=function(){function e(){this.$runTime=0;this.$paused=true;this.$stopped=true}e.prototype.lapse=function(e){this.$runTime+=e};e.prototype.pause=function(e){this.$paused=true;this.$stopped=e};e.prototype.resume=function(e){this.$paused=e;this.$stopped=false};e.prototype.getTime=function(){return this.$runTime};Object.defineProperty(e.prototype,"paused",{get:function(){return this.$paused},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"stopped",{get:function(){return this.$stopped},enumerable:true,configurable:true});return e}();r.Timeline=g;var E=function(){function e(){this.$seedId=0;this.$timers=[];this.$timerMap={};for(var e=c.MIN;e<c.MAX;e++){this.$timers[e]=[]}}e.prototype.$createNewTimerId=function(){this.$seedId++;return this.$seedId};e.prototype.executeTimer=function(){for(var e=c.MIN;e<c.MAX;e++){if($.isModulePaused(e)===false){var t=this.$timers[e];var r=$.getModuleTimestamp(e);while(t.length>0){var i=t[0];if(i.active===true){if(i.timeout>r){break}if(i.real===true){i.count++}else{i.count=Math.floor((r-i.timestamp)/i.delay)}}if(i.active===false||i.loops>0&&i.count>=i.loops){delete this.$timerMap[i.timerId]}else{this.addTimer(i.mod,i.delay,i.method,i.caller,i.loops,i.real,i.timerId,i.timestamp,i.timeout,i.count)}t.shift();if(i.active===true){i.method.call(i.caller,i.count,i.loops)}}}}};e.prototype.addTimer=function(e,t,r,i,s,n,o,a,u,f){if(s===void 0){s=1}if(n===void 0){n=false}if(o===void 0){o=0}if(a===void 0){a=-1}if(u===void 0){u=-1}if(f===void 0){f=0}var M=$.getModuleTimestamp(e);if(o===0){o=this.$createNewTimerId()}if(a===-1){a=M}if(u===-1){u=M}if(t<1){throw Error("非法的定时器执行间隔")}var l=0;if(n===true){l=(M-u)%t}else{l=(M-a)%t}u=M+t-l;var c={mod:e,active:true,delay:t,method:r,caller:i,real:n,count:f,loops:s,timerId:o,timestamp:a,timeout:u};var h=this.$timers[e];var p=-1;var d=0;var g=0;var E=h.length-1;while(E-d>1){g=Math.floor((d+E)*.5);if(h[g].timeout<=u){d=g}else if(h[g].timeout>u){E=g}else{break}}for(var I=d;I<=E;I++){if(h[I].timeout>u){p=I;break}}if(p<0){h.push(c)}else{h.splice(p,0,c)}this.$timerMap[o]=c;return o};e.prototype.removeTimer=function(e){if(e>0&&this.$timerMap[e]!==void 0){this.$timerMap[e].active=false}return 0};e.prototype.clearTimer=function(e){var t=this.$timers[e];while(t.length>0){var r=t.pop();delete this.$timerMap[r.timerId]}};return e}();r.TimerManager=E;var I;(function(e){e.engine=null;e.timeline=null;e.timeStamp=null;e.timerManager=null;e.messageManager=null})(I=r.M||(r.M={}));var m;(function(n){var o={};var r={};n.seqId=1;function e(e,t,r){if(u(e)===false){console.warn("消息发送失败，模块己暂停 mod:"+h[e]);return}if(a(e,t)===false){console.warn("消息发送失败，消息ID非法 mod:"+e+", id:"+t);return}var i=o[e]||null;if(i===null){i=o[e]=[]}var s={dst:e,seqId:n.seqId,id:t,data:r};i.push(s)}n.send=e;function t(e,t){var r=o[e]||null;if(r===null||r.length===0){return null}for(var i=0;i<r.length;i++){var s=r[i];if(e===h.NSL||s.seqId<n.seqId){if(t===void 0||s.id===t){r.splice(i,1);return s}}}return null}n.fetch=t;function a(e,t){var r,i;if(e===h.MMI){r=s.MMI_MSG_ID_BEGIN;i=s.MMI_MSG_ID_END}else if(e===h.CUI){r=s.CUI_MSG_ID_BEGIN;i=s.CUI_MSG_ID_END}else if(e===h.GUI){r=s.GUI_MSG_ID_BEGIN;i=s.GUI_MSG_ID_END}else if(e===h.L4C){r=s.L4C_MSG_ID_BEGIN;i=s.L4C_MSG_ID_END}else if(e===h.NSL){r=s.NSL_MSG_ID_BEGIN;i=s.NSL_MSG_ID_END}else{throw Error("未知的消息范围 mod:"+e)}return t>=r&&t<i}function u(e){return r[e]===true}n.isModuleActive=u;function i(e,t){r[e]=t;if(t===false){delete o[e]}}n.setModuleActive=i})(m=r.MsgQ||(r.MsgQ={}));var _;(function(s){s.MMI_COMMAND_PREFIX="MMI";s.KERNEL_COMMAND_PREFIX="sun";var i=new p;var n=new p;s.checkPrefix=false;s.msgQMap={sun:h.KAL,MMI:h.MMI};s.msgQCmd={};s.mmiMsgQMap={};function o(e){if(e.substr(0,3)===s.KERNEL_COMMAND_PREFIX){return s.KERNEL_COMMAND_PREFIX}var t=e.indexOf("_");if(t<1){throw Error("必须为命令指定一个模块名，格式如 MOD_"+e)}var r=e.substr(0,t);if(s.msgQMap[r]===void 0){throw Error("未注册的MsgQ消息前缀："+r)}return r}function e(){if(s.checkPrefix===false){return true}if(i.curMsgQMod===h.NIL||i.curMsgQMod===h.KAL||i.curMsgQMod===h.MMI){return true}return s.mmiMsgQMap[i.curMsgQMod]===true}s.enableMMIAction=e;function t(e){if(s.checkPrefix===false){return}i.active(e)}s.active=t;function r(){if(s.checkPrefix===false){return}i.deactive()}s.deactive=r;function a(e){if(s.checkPrefix===false){return}var t=o(e);var r=s.msgQMap[t];i.asserts(r,null);i.lock(r)}s.lock=a;function u(e){if(s.checkPrefix===false){return}var t=o(e);var r=s.msgQMap[t];i.asserts(r,null);i.unlock(r)}s.unlock=u;function f(e,t){if(s.checkPrefix===false){return}if(t===null||t===puremvc.Controller.inst||t===puremvc.View.inst){return}var r=o(e);var i=s.msgQMap[r];n.update(t);n.lock(i)}s.create=f;function M(e,t){if(s.checkPrefix===false){return}if(t===null||t===puremvc.Controller.inst||t===puremvc.View.inst){return}var r=o(e);var i=s.msgQMap[r];n.update(t);n.unlock(i)}s.release=M;function l(e){if(s.checkPrefix===true){i.backup(e)}}s.backup=l;function c(){if(s.checkPrefix===true){i.restore()}}s.restore=c})(_=r.Mutex||(r.Mutex={}));var $;(function(o){function t(e){if(e===c.TIMELINE){if(I.timeline===null||I.timeline.stopped===true){return true}}else if(e===c.CUSTOM){if(I.timeStamp===null||I.timeStamp.stopped===true){return true}}else if(I.engine===null){return true}return false}o.isModuleStopped=t;function e(e){if(t(e)===true){return true}if(e===c.TIMELINE){return I.timeline.paused}else if(e===c.CUSTOM){return I.timeStamp.paused}return false}o.isModulePaused=e;function r(){if(t(c.SYSTEM)===false){return I.engine.getDelta()}else{console.error("尝试获取帧时间间隔，但系统模块己停止！！！")}}o.getDelta=r;function i(e){if(t(e)===false){if(e===c.TIMELINE){return I.timeline.getTime()}else if(e===c.CUSTOM){return I.timeStamp.getTime()}return I.engine.getTime()}else{console.error("尝试获取时间戳，但模块 "+c[e]+" 己停止！！！")}}o.getModuleTimestamp=i;function s(e,t,r){if(o.isModuleStopped(e)===false){var i={mod:e,task:r,groupId:t,priority:l.PRIORITY_TASK};I.messageManager.putMessage(i)}else{console.error("尝试添加任务，但模块 "+c[e]+" 己停止！！！")}}o.addTask=s;function n(e,t){I.messageManager.cancelTaskByGroupId(e,t)}o.cancelTaskByGroupId=n;function a(e,t,r){if(o.isModuleStopped(e)===false){var i={mod:e,handler:r,timeout:o.getModuleTimestamp(e)+t,priority:l.PRIORITY_TRIGGER};I.messageManager.putMessage(i)}else{console.error("尝试添加触发器，但模块 "+c[e]+" 己停止！！！")}}o.addTrigger=a;function u(e,t,r){if(o.isModuleStopped(e)===false){var i={mod:e,handler:r,priority:t};I.messageManager.putMessage(i)}else{console.error("尝试添加Message消息，但模块 "+c[e]+" 己停止！！！")}}o.addMessage=u;function f(e,t,r,i,s,n){if(s===void 0){s=1}if(n===void 0){n=false}if(o.isModuleStopped(e)===false){return I.timerManager.addTimer(e,t,r,i,s,n)}else{console.error("尝试添加定时器，但模块 "+c[e]+" 己停止！！！")}}o.addTimer=f;function M(e){return I.timerManager.removeTimer(e)}o.removeTimer=M})($=r.System||(r.System={}))})(suncore||(suncore={}));